<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<title>Overlay YouTube film</title>
<meta charset="UTF-8">
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-1.11.0.min.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<style>
.chart rect {
  fill: steelblue;
}

.chart text {
  fill: white;
  font: 10px sans-serif;
  text-anchor: end;
}


</style>
<script src="http://d3js.org/d3.v3.min.js"></script>


</head>
<body>
    <p>
        <label >母體元素</label>
        <input type="text" id="population" value="2,4,6,8,10"></input>
    </p>
    <p>
        <label >抽樣樣本數</label>
        <input type="text" id="samplesize" value="10">
        <label >實驗次數</label>
        <input type="text" id="replication" value="300">
        <label >長條數目</label>
        <input type="text" id="noOfPartition" value="10">
    </p>
    <p><button onclick="histo()">模擬</button></p>
    <p>
        <label>母體\(\mu:\)</label>
        <label id="mu"></label>
        <label>母體\(\sigma:\)</label>
        <label id="sigma"></label>
    </p>
    <p>
        <label>樣本平均的期望值:</label>
        <label id="samplemu"></label>
        <label>樣本平均的標準差:</label>
        <label id="samplesigma"></label>
    </p>
    <p id="histogram">
    <svg class="chart"></svg>

    </p>
    <p>
        <label>區間下限:</label>
        <input type="text" id="lowerlimit"></input>
        <label>區間上限:</label>
        <input type="text" id="upperlimit"></input>
        <button type="button">計算</button>
        <label>近似機率:</label>
        <label id="aproxprob"></label>
        <label>實際頻率:</label>
        <label id="frequency"></label>
    </p>
<script>
    function sampleFromArrayWithReplacement(arr, size, replication) {
        var buf = [];
        for (var j = 0; j < replication; j++) {
            var sum = 0;
            for (i = 0; i < size; i++) {
                var ind = Math.floor(Math.random() * arr.length);
                sum = sum + arr[ind];
            }
            buf.push(sum / size);
        }
        return buf;
    }
    function count(data, noOfPartition) {
        var min = data[0];
        var max = data[0];
        for (var i = 0; i < data.length; i++) {
            if (data[i] < min) min = data[i];
            if (data[i] > max) max = data[i];
        }
        max = min + (max - min) * 1.001;
        var step = (max - min) / noOfPartition;
        var res = [];
        for (i = 0; i < noOfPartition; i++) {
            res.push(0);
        }
        for (i = 0; i < data.length; i++) {
            var ind = Math.floor((data[i] - min) / step);
            res[ind] = res[ind] + 1;
        }
        return res;
    }
    function histo() {
        // Generate a Bates distribution of 10 random variables.
        //var arr = d3.select('#population').attr('value').split(',');
        var arr = document.getElementById('population').value.split(',');
        for (i = 0; i < arr.length; i++) arr[i] = parseFloat(arr[i]);
        //var n = parseInt(d3.select('#noOfPartition').attr('value'));
        var n = parseInt(document.getElementById('noOfPartition').value);
        //var replication = parseInt(d3.select('#replication').attr('value'));
        var replication = parseInt(document.getElementById('replication').value);
        //var size = parseInt(d3.select('#samplesize').attr('value'));
        var size = parseInt(document.getElementById('samplesize').value);
        var values = sampleFromArrayWithReplacement(arr, size, replication);
        var data = count(values, n);
        var width = 960,
        height = 500;

        var y = d3.scale.linear()
        .range([height, 0]);

        var chart = d3.select(".chart")
        .attr("width", width)
        .attr("height", height);

        chart.selectAll("g").remove();
        y.domain([d3.min(data, function (d) { return d; }), d3.max(data, function (d) { return d; })]);

        var barWidth = width / data.length;

        var bar = chart.selectAll("g")
          .data(data)
        .enter().append("g")
          .attr("transform", function (d, i) { return "translate(" + i * barWidth + ",0)"; });

        bar.append("rect")
          .attr("y", function (d) { return y(d); })
          .attr("height", function (d) { return height - y(d); })
          .attr("width", barWidth - 1);

        bar.append("text")
          .attr("x", barWidth / 2)
          .attr("y", function (d) { return y(d) + 3; })
          .attr("dy", ".75em")
          .text(function (d) { return d; });
    }
</script>        
</body>
</html>
